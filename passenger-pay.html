<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–û–ø–ª–∞—Ç–∞ ‚Äî RideNow</title>
<style>
  :root{--ink:#eaf2ff;--muted:#a6b5cc;--stroke:rgba(255,255,255,.18);--glass-1:rgba(14,21,26,.55);--glass-2:rgba(14,21,26,.35);--g1:#ffb668;--g2:#9de9d7;--gutter:16px}
  html,body{height:100%;margin:0}
  body{color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,rgba(0,0,0,.65),rgba(0,0,0,.55) 35%,rgba(0,0,0,.45) 60%,rgba(0,0,0,.55)),url("image.png") center/cover fixed;
    padding:var(--gutter);display:flex}
  main{margin:auto;width:min(760px,calc(100vw - var(--gutter)*2));border:1px solid var(--stroke);border-radius:22px;
    background:linear-gradient(180deg,var(--glass-1),var(--glass-2));box-shadow:0 30px 80px rgba(0,0,0,.45)}
  .inner{padding:16px}
  h2{margin:0 0 12px}
  .card{border:1px solid var(--stroke);border-radius:16px;padding:12px;background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.06));margin-bottom:12px}
  .note{color:#cfe3ff;font-size:14px}
  .pill{display:inline-grid;place-items:center;padding:8px 12px;border-radius:14px;font-weight:900;background:linear-gradient(90deg,#b8ff9c,#7dffcf);color:#072e12}

  /* –ú–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã */
  .methods-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px} /* <-- –≤–∏–¥–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
  .paybtn{height:52px;border-radius:14px;border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    color:var(--ink);font-weight:900;font-size:16px;cursor:pointer;display:grid;place-items:center}
  .paybtn.primary{border:0;color:#0b0f12;background:linear-gradient(90deg,var(--g1),var(--g2));box-shadow:0 10px 24px rgba(183,167,255,.25)}
  .paybtn.gpay::before{content:"üÖñ ";font-weight:900}
  .paybtn.apay::before{content:"Ô£ø ";font-weight:900}

  /* –§–æ—Ä–º–∞ –∫–∞—Ä—Ç—ã (—Å–ª–µ–≤–∞ —Å–≤–µ—Ä—Ö—É) */
  .cardform{border:1px solid var(--stroke);border-radius:14px;padding:10px;background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06))}
  .label{font-size:12px;color:var(--muted);margin:4px 0 6px}
  .inp{width:100%;height:44px;border-radius:10px;border:1px solid var(--stroke);background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.05));color:var(--ink);padding:0 10px;font-weight:700}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
  .submit{margin-top:10px}

  @media (max-width:380px){ .methods-grid{grid-template-columns:1fr} }
</style>
</head>
<body>
  <main>
    <div class="inner">
      <h2>–û–ø–ª–∞—Ç–∞</h2>

      <!-- –†–µ–∑—é–º–µ -->
      <div class="card" id="summary"></div>

      <!-- –ï—Å–ª–∏ –µ—Å—Ç—å ¬´–∫—Ä–µ–¥–∏—Ç¬ª 25 ‚Ç¥ -->
      <button class="paybtn primary" id="voucherCta" style="display:none">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏</button>

      <!-- –ú–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã (2 —Ä—è–¥–∞: –ö–∞—Ä—Ç–∞ + Mono, –Ω–∏–∂–µ GPay + Apple Pay) -->
      <div class="methods-grid" id="methods">
        <form class="cardform" id="cardForm">
          <div class="label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
          <input class="inp" id="cc_number" inputmode="numeric" autocomplete="cc-number" placeholder="0000 0000 0000 0000" required />
          <div class="row2">
            <div>
              <div class="label">–°—Ä–æ–∫ (–ú–ú/–ì–ì)</div>
              <input class="inp" id="cc_exp" inputmode="numeric" autocomplete="cc-exp" placeholder="MM/YY" required />
            </div>
            <div>
              <div class="label">CVC</div>
              <input class="inp" id="cc_cvc" inputmode="numeric" autocomplete="cc-csc" placeholder="CVC" required />
            </div>
          </div>
          <div class="label" style="margin-top:8px">–ò–º—è –Ω–∞ –∫–∞—Ä—Ç–µ</div>
          <input class="inp" id="cc_name" autocomplete="cc-name" placeholder="IVAN IVANOV" required />
          <button type="submit" class="paybtn primary submit" id="payCardBtn">–û–ø–ª–∞—Ç–∏—Ç—å 25 ‚Ç¥</button>
        </form>

        <button class="paybtn" id="monoBtn">Mono Pay</button>
        <button class="paybtn gpay" id="gpayBtn">Google Pay</button>
        <button class="paybtn apay" id="apayBtn">Apple Pay</button>
      </div>

      <button class="paybtn" id="toActive" style="display:none">–ö –∞–∫—Ç—É–∞–ª—å–Ω—ã–º</button>

      <div class="note" style="margin-top:10px">
        –û–Ω–ª–∞–π–Ω —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä 25 ‚Ç¥ ‚Äî –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ RideNow. –û—Å—Ç–∞–ª—å–Ω–æ–µ –ø–ª–∞—Ç–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—é –Ω–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏ –ø–æ—Å–∞–¥–∫–µ.
      </div>
    </div>
  </main>

  <!-- rn-core (–µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –Ω–∏–∂–µ –±—É–¥–µ—Ç ¬´—à–∏–º¬ª) -->
  <script src="rn-core.js"></script>

  <!-- –®–∏–º RN: –≤–∫–ª—é—á–∏—Ç—Å—è, –µ—Å–ª–∏ rn-core.js –Ω–µ –Ω–∞—à—ë–ª—Å—è / RN –Ω–µ –æ–±—ä—è–≤–ª–µ–Ω -->
  <script>
    (function(){
      if (window.RN) return;
      const get = (k)=>{ try{ return JSON.parse(localStorage.getItem(k)); }catch{ return null } };
      const set = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
      window.RN = {
        keys:{
          bookingDraft:'rn:booking:draft',
          booking:'rn:booking:active',
          voucher:'rn:voucher'
        },
        get,set,
        fmtMoney:(v)=> `${v} ‚Ç¥`,
        isPaid:(id)=> !!get(`rn:paid:${id}`),
        markPaid:(id)=> set(`rn:paid:${id}`, 1)
      };
      console.warn('[RN shim] rn-core.js –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π shim');
    })();
  </script>

  <script>
    // ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =====
    const qs = new URLSearchParams(location.search);
    const tripId = qs.get('tripId') || (RN.get(RN.keys.bookingDraft)?.id) || 'kyiv-odesa';
    const draft  = RN.get(RN.keys.bookingDraft) || { id: tripId, price: 550, from:'–ö–∏–µ–≤', to:'–û–¥–µ—Å—Å–∞', date:'16.09.2025' };

    const summary   = document.getElementById('summary');
    const methodsUI = document.getElementById('methods');
    const voucherCta= document.getElementById('voucherCta');
    const toActive  = document.getElementById('toActive');

    const voucher = RN.get(RN.keys.voucher) || null;
    const usingVoucher = !!(voucher && Number(voucher.amount) >= 25 && !voucher.used && (!voucher.lockedForTripId || voucher.lockedForTripId === tripId));

    function renderSummary(already){
      const feeText = usingVoucher ? '0 ‚Ç¥ ‚Äî –ø–æ–∫—Ä—ã—Ç –±–æ–Ω—É—Å–æ–º' : '25 ‚Ç¥';
      const extra   = usingVoucher ? ' (–∫–æ–º–∏—Å—Å–∏—è —Å–ø–∏—à–µ—Ç—Å—è —Å –±–æ–Ω—É—Å–∞)' : '';
      summary.innerHTML = `
        <div style="font-weight:900">${draft.from} ‚Üí ${draft.to} ‚Ä¢ ${draft.date}</div>
        <div style="margin-top:6px">–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä: <strong>${feeText}</strong>${extra}</div>
        <div>–í–æ–¥–∏—Ç–µ–ª—é ‚Äî –Ω–∞–ª–∏—á–Ω—ã–º–∏: <strong>${RN.fmtMoney(draft.price)}</strong></div>
        ${already ? '<div style="margin-top:8px" class="pill">–≠—Ç–∞ –ø–æ–µ–∑–¥–∫–∞ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω–∞</div>' : ''}
      `;
    }

    if (RN.isPaid(tripId)) {
      renderSummary(true);
      toActive.style.display = 'block';
      methodsUI.style.display = 'none';
      voucherCta.style.display = 'none';
    } else {
      renderSummary(false);
      if (usingVoucher) {
        voucherCta.style.display = 'grid';
        methodsUI.style.display  = 'none';
      }
    }

    function consumeVoucherIfAny(){
      if (!usingVoucher) return;
      const v = { ...(voucher || {}) };
      v.amount = Math.max(0, Number(v.amount) - 25);
      v.used   = true;
      v.usedAt = Date.now();
      v.lastTripId = tripId;
      delete v.lockedForTripId;
      RN.set(RN.keys.voucher, v);
    }

    function completePayment(method){
      RN.markPaid(tripId);
      RN.set(RN.keys.booking, {
        id: tripId, from:draft.from, to:draft.to, date:draft.date, price:draft.price,
        seats:draft.seats||1, comment:draft.comment||'', status:'pending', createdAt: Date.now(), paid:1
      });
      location.href = 'active-passenger.html?state=pending&tripId=' + encodeURIComponent(tripId) + '&pm=' + encodeURIComponent(method);
    }

    // ==== –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ====
    document.getElementById('cardForm').addEventListener('submit',(e)=>{
      e.preventDefault();
      const num = document.getElementById('cc_number').value.replace(/\s+/g,'');
      const exp = document.getElementById('cc_exp').value.trim();
      const cvc = document.getElementById('cc_cvc').value.trim();
      const name= document.getElementById('cc_name').value.trim();
      if (num.length < 15 || !/^\d{2}\/\d{2}$/.test(exp) || cvc.length < 3 || name.length < 2){
        alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã'); return;
      }
      completePayment('card');
    });
    document.getElementById('monoBtn').onclick = ()=> completePayment('mono');
    document.getElementById('gpayBtn').onclick = ()=> completePayment('gpay');
    document.getElementById('apayBtn').onclick = ()=> completePayment('applepay');
    voucherCta.onclick = ()=>{ consumeVoucherIfAny(); completePayment('voucher'); };
    toActive.onclick = ()=> location.href='active-passenger.html';
  </script>
</body>
</html>
