<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Оценка водителя — RideNow</title>
<style>
  body{margin:0;display:flex;min-height:100vh;align-items:center;justify-content:center;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#eaf2ff;
    background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.55) 35%, rgba(0,0,0,.45) 60%, rgba(0,0,0,.55)),
      url("image.png") center/cover fixed}
  .card{width:min(680px,92vw);border:1px solid rgba(255,255,255,.18);border-radius:22px;
    background:linear-gradient(180deg,rgba(14,21,26,.55),rgba(14,21,26,.35));padding:16px}
  .row{display:flex;gap:8px;justify-content:center;margin:12px 0}
  .star{font-size:30px;cursor:pointer;opacity:.7} .star.on{opacity:1}
  .btn{height:52px;border-radius:14px;border:0;cursor:pointer;width:100%;font-weight:900;color:#0b0f12;
    background:linear-gradient(90deg,#ffb668,#9de9d7)}
  textarea{width:100%;min-height:90px;border-radius:12px;border:1px solid rgba(255,255,255,.18);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    color:#eaf2ff;padding:10px;outline:none}
</style>
</head>
<body>
  <div class="card">
    <h2 style="margin:6px 0 8px">Оцените поездку</h2>
    <div id="route" style="opacity:.9"></div>
    <div class="row" id="stars">
      <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>
    </div>
    <textarea id="comment" placeholder="Комментарий (необязательно)"></textarea>
    <div style="margin-top:10px"><button class="btn" id="send">Отправить</button></div>
  </div>

  <script src="rn-core.js"></script>
  <script>
    const q = new URLSearchParams(location.search);
    const tripId = q.get('tripId') || 'kyiv-odesa';
    const b = RN.get(RN.keys.booking)||{};
    document.getElementById('route').textContent = `${b.from||'—'} → ${b.to||'—'} • ${b.date||''}`;

    // простая звёздная оценка
    let rating = 5;
    const stars = [...document.querySelectorAll('.star')];
    function paint(n){ stars.forEach((s,i)=> s.classList.toggle('on', i<n)); }
    stars.forEach((s,i)=> s.onclick = ()=>{ rating=i+1; paint(rating); }); paint(rating);

    document.getElementById('send').onclick = ()=>{
      const km = +(q.get('km')||b.km||0);
      const credit = Math.floor(km/10); // 100км -> 10₴  (пример: 475км -> 47₴)

      // сохраним в историю (простейшая схема)
      const hist = RN.get('rn:history')||[];
      hist.unshift({
        id: tripId, from:b.from, to:b.to, date:b.date, price:b.price, km,
        rating, comment: document.getElementById('comment').value.trim(),
        finishedAt: Date.now()
      });
      RN.set('rn:history', hist);

      // начислим бонусы в кошелёк
      const wallet = RN.get('rn:wallet')||{balance:0};
      wallet.balance = Math.max(0, Number(wallet.balance)||0) + credit;
      RN.set('rn:wallet', wallet);

      // очистим активную бронь
      RN.set(RN.keys.booking, null);

      // готово
      location.href = 'active.html?state=empty';
    };
  </script>
</body>
</html>
